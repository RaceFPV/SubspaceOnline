$(function() {
  var socket;
  socket = new WebSocket("ws://" + window.location.host + "/movement");
  socket.onmessage = function(event) {
    if (event.data.length) {
      switch (event.data) {
        case "left":
          movementSystem(event.data)
          break;
        case "right":
          movementSystem(event.data)
          break;
        case "up":
          movementSystem(event.data)
          break;
        case "leftend":
          movementSystem(event.data)
          break;
        case "rightend":
          movementSystem(event.data)
          break;
        case "upend":
          movementSystem(event.data)
          break;
        default:
          $("#chat").append("<%= current_or_guest_player.email %> : " + event.data + "<br>");
          document.getElementById('chat').scrollTop = 9999999;
          break;
      }
    }
  };

$("body").keydown(function(e) {
  if(e.keyCode == 37) { // left
    //  Move to the left
    socket.send("left");
  }
  else if(e.keyCode == 39) { // right
    //  Move to the right
    socket.send("right");
  }
  else if(e.keyCode == 38) { // up
    //  Move up
    socket.send("up");
  }
});

$("body").keyup(function(e) {
  if(e.keyCode == 37) { // left
    //  Move to the left
    socket.send("leftend");
  }
  else if(e.keyCode == 39) { // right
    //  Move to the right
    socket.send("rightend");
  }
  else if(e.keyCode == 38) { // up
    //  Move up
    socket.send("upend");
  }
});

  return $("#chatform").on("submit", function(event) {
    var $input;
    event.preventDefault();
    $input = $(this).find("#message_content");
    socket.send($input.val());
    return $input.val(null);
  });
});
